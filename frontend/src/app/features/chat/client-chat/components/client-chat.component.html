<div class="chat-container">
  <h2>Support</h2>

  <div *ngIf="!isChatStarted" class="login-form">
    <h3>Start a support chat</h3>
    <input
      type="text"
      [(ngModel)]="username"
      placeholder="Your name"
      [disabled]="isLoading"
      (keyup.enter)="startChat()"
    />
    <button
      (click)="startChat()"
      [disabled]="isLoading"
    >
      <span *ngIf="!isLoading">Start the chat</span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <p *ngIf="isLoading" class="loading-message">
      Loading to server ...
    </p>
  </div>

  <div *ngIf="isChatStarted" class="chat-area">
    <div class="chat-info">
      <p><strong>Room ID :</strong> {{ roomId }}</p>
      <p><strong>Connected as :</strong> {{ username }}</p>
      <p *ngIf="isConnected" class="status-connected">Connected</p>
      <p *ngIf="!isConnected" class="status-disconnected">Disconnected</p>
      <p class="info-text">
        <small>Share Room ID with an employee so they can join you</small>
      </p>
    </div>

    <div class="messages-container">
      <div *ngIf="messages.length === 0" class="empty-messages">
        Waiting for an employee ...
      </div>

      <div *ngFor="let message of messages"
           [class]="'message message-' + message.type.toLowerCase()"
           [class.own-message]="message.senderId === userId">
        <div *ngIf="message.type === 'CHAT'" class="chat-message" style="display: flex;">
          <img *ngIf="message.senderId !== userId" src="logo_ycyw.png" alt="Employee" class="employee-avatar" style="width: 50px; padding-left: 10px; padding-right: 10px;"/>
          <img *ngIf="message.senderId === userId" src="logo_avatar.png" alt="Client" class="employee-avatar" style="width: 50px; padding-left: 10px; padding-right: 10px;"/>
          <div style="display: flex; align-items: center;"><strong>{{ message.senderName }}: &nbsp;</strong> {{ message.content }}</div>
        </div>
        <div *ngIf="message.type === 'JOIN'" class="system-message">
          {{ message.content }}
        </div>
        <div *ngIf="message.type === 'LEAVE'" class="system-message">
          {{ message.content }}
        </div>
      </div>
    </div>

    <div class="message-input">
      <input
        type="text"
        [(ngModel)]="messageContent"
        placeholder="Type your message ..."
        [disabled]="!isConnected"
        (keyup.enter)="sendMessage()"
      />
      <button (click)="sendMessage()" [disabled]="!isConnected || !messageContent.trim()">
        Send
      </button>
    </div>
  </div>
</div>
